bilibili-data
===
哔哩哔哩弹幕网数据爬虫
---

基于Python3，使用了gevent进行携程，需要以下库支持:  
> sudo -H pip install BeautifulSoup4 requests gevent pymongo  

默认使用了SQLite存储数据，你也可以用mongodb，将代码中的WriteData替换为MongoData即可

BeautifulSoup 用了 lxml 来解析网页，你可能需要安装 lxml 库：  
> sudo -H pip install lxml  

但是 pip 安装 lxml 速度奇慢而且很可能报错，如果你是 Ubuntu 或者 Debian，推荐：  
> sudo apt-get install python-lxml

如果你是 Windows 用户，请去 [这里](http://www.lfd.uci.edu/~gohlke/pythonlibs/#lxml) 下载对应版本的whl来安装

使用方法
---

* 稿件基本数据
> python avid.py

* 稿件评论数据
> python comment.py

That's all.

P.S.

目前抓取的稿件数据为：
---

| AV号 | 标题 | mid | 昵称 | 投稿时间 | 分区 | 缩略图 | 状态 |
 ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- |
| INT | CHAR | INT | CHAR | CHAR | CHAR | CHAR | INT |
| ----- | ----- | ----- | ----- | ----- | ----- | ----- | 200（正常稿件） |
| ----- | 跳转地址 | 0 | bilibili | NULL | NULL | NULL | 301（撞车跳转） |
| ----- | 不能访问 | 0 | bilibili | NULL | NULL | NULL | 404（不能访问） |
| ----- | 页面不存在 | 0 | bilibili | NULL | NULL | NULL | 404（不能访问） |

* 锁定稿件、删除稿件、会员稿件的状态都是404，之后会考虑识别会员状态。
* 「页面不存在」可能是因为稿件尚在审核中。
* 用户投稿数可通过目前数据倒推，其他数据目前没有计划。
* 因为没有使用API，理论上不会被限制？暴力抓取被封IP请自行负责。
* 目前的数据量是1.20GB，不会有网盘下载的，放弃吧。


目前抓取的评论数据为：
---

| AV号 | 主楼层 | 次楼层 | mid | 评论时间 | 可读时间 | 内容 | 设备 | 评论ID |
 ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- |
| INT | INT | INT | INT | INT | CHAR | CHAR | CHAR | INT |
| ----- | 1096 | 0（主楼） | ----- | ----- | ----- | ----- | 1（网页） | ----- |
| ----- | 1 | 2（楼中楼） | ----- | ----- | ----- | ----- | 2（安卓） | ----- |
| ----- | ----- | ----- | ----- | ----- | ----- | ----- | 3（iOS） | ----- |
| ----- | ----- | ----- | ----- | ----- | ----- | ----- | 4（Windows Phone） | ----- |
| ----- | ----- | ----- | ----- | ----- | ----- | ----- | 5（安卓？） | ----- |

* 设备信息具体对应不确定，仅作参考
* 未确认评论中av号链接和@功能的存储方式


目前抓取的弹幕数据为：
---

| AV号 | cid | 发送时间 | 时间位置 | 类型 | 字号 | 颜色 | mid校验 | 内容 | 弹幕ID |
 ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- |
| INT | INT | CHAR | FLOAT | INT | INT | CHAR | CHAR | CHAR | INT |
| ----- | ----- | ----- | ----- | 1（普通弹幕） | ----- | #FFFFFF | ----- | ----- | ----- |
| ----- | ----- | ----- | ----- | 4（底部弹幕） | ----- | ----- | ----- | ----- | ----- |
| ----- | ----- | ----- | ----- | 5（顶部弹幕） | ----- | ----- | ----- | ----- | ----- |
| ----- | ----- | ----- | ----- | 7（高级弹幕） | ----- | ----- | ----- | ----- | ----- |

* 未确认其他类型弹幕的具体对应关系